@using Basyc.MessageBus.Manager.Application
@using Basyc.MessageBus.Manager.Application.ResultDiagnostics
@using Basyc.MessageBus.Manager.Presentation.BlazorLibrary.Pages.ResultHistory.ResultHistoryItem
@inject IRequestDiagnosticsManager resultLoggingManager;


<historyView>
    @if (RequestResults is not null)
    {
        @foreach (var result in RequestResults.AsEnumerable().Reverse())
        {
            var diagnosticsContext = resultLoggingManager.GetContext(result);
            <button @onclick="() => SelectedRequestResults = result" class="resultHistoryItemViewButton">
                <ResultHistoryItemView RequestResult="result" DiagnosticsContext="diagnosticsContext" IsSelected="result == SelectedRequestResults" />
            </button>
        }
    }
    else
    {
        @:empty history
    }
</historyView>

@code {
    [Parameter] public List<RequestResult> RequestResults { get; set; }
    private RequestResult selectedRequestResults;

    [Parameter] 
    public RequestResult SelectedRequestResults
    {
        get => selectedRequestResults;
        set
        {
            if (value == selectedRequestResults) return;
            selectedRequestResults = value;
            SelectedRequestResultsChanged.InvokeAsync(value);
        }
    }

    [Parameter]
    public EventCallback<RequestResult> SelectedRequestResultsChanged { get; set; }

}
